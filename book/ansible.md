#### Ansible 
Ansible это инструмент автоматизации, который используется для управления конфигурациями, развертывания приложений и оркестрации ИТ-инфраструктуры. Основные характеристики:

1. Простота использования: Ansible не требует установки агентов на целевых машинах, работает через SSH.
2. Идмопотентность: повторное выполнение задач не изменяет результат, если состояние системы уже соответствует желаемому.
3. Модульная архитектура: задачи (tasks) и плейбуки (playbooks) создаются на базе модулей, которые поддерживают различные технологии (сетевые устройства, базы данных и т.д.).
4. Использует YAML: конфигурации и сценарии автоматизации описываются в формате YAML.
5. Расширяемость: легко интегрируется с другими DevOps-инструментами, такими как Jenkins, Docker и Kubernetes.
6. Масштабируемость: Ansible может управлять как несколькими серверами, так и тысячами узлов одновременно.

Применение:
- Управление конфигурацией серверов.
- Оркестрация контейнеров и приложений.
- Автоматизация развертывания приложений.
- Управление сетевой инфраструктурой.

#### Основные понятия Ansible:

1. Inventory (инвентарь) — список серверов или устройств, которыми Ansible будет управлять. Может быть представлен в виде файла или динамически сгенерированного списка.
2. Playbook (плейбук) — основной сценарий, содержащий набор задач (tasks), которые Ansible выполнит на целевых машинах. Написан на языке YAML.
3. Task (задача) — единичное действие, которое выполняется на узле. Каждая задача использует модуль для выполнения конкретной операции.
4. Module (модуль) — предварительно написанный код, который выполняет конкретные задачи, такие как установка пакетов, управление файлами или перезагрузка сервисов.
5. Role (роль) — логическое объединение плейбуков, файлов шаблонов, конфигурационных файлов и других ресурсов для упрощения и повторного использования сценариев.
6. Handler (обработчик) — специальная задача, которая выполняется при наступлении определенного события, например, перезапуск службы после изменения конфигурации.
7. Variable (переменная) — параметры, которые могут быть использованы в плейбуках для более гибкого управления конфигурациями.
8. Template (шаблон) — файлы конфигурации, которые используют шаблонизатор Jinja2 для подстановки переменных.
9. Fact (факты) — данные об узле, которые Ansible автоматически собирает перед выполнением задач (например, операционная система, IP-адрес).
10. Galaxy — репозиторий, где можно найти готовые роли для различных задач.
11. Vault — механизм шифрования, который позволяет безопасно хранить и использовать конфиденциальные данные, такие как пароли или ключи.
12. Play (игра) — это набор задач, который направлен на выполнение конкретной операции на определённых узлах, указанных в инвентаре.

----

Когда запускается плейбук Ansible, происходит следующий процесс:

1. **Определение инвентаря**: Ansible загружает инвентарь, чтобы определить целевые узлы (серверы), на которых будут выполняться задачи.
2. **Установление соединения**: Ansible устанавливает SSH-соединение с каждым узлом (если не указано другое соединение, например, WinRM для Windows).
3. **Сбор фактов**: Ansible собирает "факты" о целевых узлах (например, операционная система, IP-адрес, версия Python), которые могут использоваться в задачах или для логики плейбука.
4. **Выполнение задач**: Ansible проходит через все задачи (tasks) плейбука по порядку, выполняя их на указанных серверах. Если задача зависит от условий (например, проверки состояния или переменной), она выполняется только при выполнении условия.
5. **Idempotency (идемпотентность)**: Ansible проверяет текущее состояние системы перед выполнением каждой задачи, чтобы избежать повторных действий. Если узел уже находится в требуемом состоянии, задача не будет изменять его.
6. **Использование ролей и переменных**: Если плейбук использует роли или переменные, Ansible подтягивает нужные файлы из соответствующих директорий (например, для шаблонов или файлов конфигураций).
7. **Обработчики (handlers)**: Если задача изменяет состояние системы (например, перезапуск службы), вызываются обработчики в конце выполнения задач.
8. **Отчет и завершение**: После выполнения всех задач Ansible выдает отчет о выполненных действиях (успех, изменение, ошибка).

### Запуск только части плейбука:

1. **Теги (tags)**: Чтобы запустить только часть плейбука, можно использовать теги для маркировки задач.
   - В плейбуке каждая задача может быть помечена тегом, например:
     ```yaml
     - name: Install Nginx
       apt:
         name: nginx
         state: present
       tags: install_nginx
     ```
   - Запуск плейбука с указанием тега:
     ```bash
     ansible-playbook playbook.yml --tags "install_nginx"
     ```

2. **--start-at-task**: Если необходимо начать выполнение с конкретной задачи, можно использовать опцию `--start-at-task`:
   - Запуск с определенной задачи:
     ```bash
     ansible-playbook playbook.yml --start-at-task="Install Nginx"
     ```

### Запуск плейбука на части серверов:

1. **--limit**: Чтобы запустить плейбук на конкретных серверах из инвентаря, можно использовать опцию `--limit`:
   - Запуск на конкретных серверах (группах серверов):
     ```bash
     ansible-playbook playbook.yml --limit "webservers"
     ```
   - Также можно указать несколько серверов или диапазон:
     ```bash
     ansible-playbook playbook.yml --limit "web1,web2,db*"
     ```

Таким образом, можно гибко управлять запуском как отдельных задач, так и целевых серверов при выполнении плейбука.


Лучшие практики работы с Ansible:

1. **Используйте роли для структурирования плейбуков**
   - Разделяйте плейбуки на роли (roles) для улучшения читаемости, повторного использования и управления сценариями автоматизации.
   - Структура ролей упрощает управление зависимостями и позволяет использовать готовые решения из Ansible Galaxy.
   - Пример структуры роли:
     ```
     roles/
       myrole/
         tasks/
         handlers/
         templates/
         files/
         vars/
         defaults/
         meta/
     ```

2. **Создавайте идемпотентные плейбуки**
   - Убедитесь, что ваши плейбуки и задачи идемпотентны, то есть могут быть безопасно выполнены несколько раз без изменения состояния системы, если оно уже соответствует требуемому.
   - Используйте подходы вроде проверок состояния перед выполнением задач (например, проверяйте, установлен ли пакет, прежде чем его устанавливать).

3. **Используйте теги для выборочного выполнения задач**
   - Теги позволяют группировать задачи и запускать только их определённые части, что упрощает выборочное выполнение плейбуков и повышает их гибкость.
   - Пример тега:
     ```yaml
     - name: Install Nginx
       apt:
         name: nginx
         state: present
       tags: install_nginx
     ```
   - Использование тегов:
     ```bash
     ansible-playbook playbook.yml --tags "install_nginx"
     ```

4. **Документируйте плейбуки и роли**
   - Добавляйте комментарии и описания к плейбукам, задачам и ролям. Это улучшит понимание кода другими инженерами и упростит его поддержку.
   - Используйте описательные имена для задач и файлов, чтобы они ясно отражали выполняемые операции.

5. **Используйте переменные и файлы конфигурации**
   - Переменные делают ваши плейбуки более гибкими и позволяют повторно использовать код для разных сред (production, staging и т.д.).
   - Структурируйте переменные по уровням: переменные инвентаря, плейбуков, ролей и глобальные настройки.
   - Пример использования переменной:
     ```yaml
     - name: Install Nginx
       apt:
         name: "{{ nginx_package }}"
     ```

6. **Работайте с конфиденциальными данными через Ansible Vault**
   - Храните чувствительные данные (пароли, ключи) в зашифрованном виде с помощью Ansible Vault, чтобы избежать утечек и обеспечить безопасность данных.
   - Использование Ansible Vault:
     ```bash
     ansible-vault encrypt vars/secret.yml
     ansible-playbook playbook.yml --ask-vault-pass
     ```

7. **Проводите тестирование плейбуков**
   - Перед выполнением плейбуков на production-серверах проводите их тестирование на тестовых окружениях.
   - Используйте инструменты, такие как Molecule, для тестирования ролей и плейбуков в различных сценариях.
   - Всегда выполняйте проверку синтаксиса перед запуском плейбуков:
     ```bash
     ansible-playbook playbook.yml --syntax-check
     ```

8. **Используйте динамический инвентарь для облачных сред**
   - Для управления облачными серверами используйте динамический инвентарь, который позволяет автоматически получать список узлов с облачных провайдеров (AWS, GCP, Azure).
   - Это упрощает работу с изменяющимися инфраструктурами и облегчает масштабирование.

9. **Минимизируйте количество задач в одном плейбуке**
   - Разделяйте большие плейбуки на несколько более мелких, чтобы они были проще для понимания и отладки.
   - Используйте включение плейбуков (include), чтобы делать код более модульным и читаемым.

10. **Управляйте зависимостями ролей**
    - В роли включайте мета-информацию о зависимостях от других ролей, чтобы Ansible мог автоматически подтягивать нужные компоненты.
    - Пример файла `meta/main.yml`:
      ```yaml
      dependencies:
        - { role: common, tags: ['common'] }
      ```

11. **Оптимизируйте сбор фактов**
    - По умолчанию Ansible собирает факты о каждом узле перед выполнением задач. Это может быть ресурсоемко на больших инфраструктурах.
    - Отключайте сбор фактов для задач, которые не требуют этой информации:
      ```yaml
      - hosts: all
        gather_facts: no
      ```

12. **Используйте хендлеры (handlers) для управления состоянием сервисов**
    - Хендлеры позволяют выполнять задачи, такие как перезапуск службы, только в случае необходимости (например, когда был изменен файл конфигурации).
    - Пример хендлера:
      ```yaml
      - name: restart nginx
        service:
          name: nginx
          state: restarted
      ```

13. **Оптимизируйте выполнение плейбуков**
    - Используйте параметр `forks` для параллельного выполнения задач на нескольких серверах одновременно, что ускоряет выполнение на больших инфраструктурах:
      ```bash
      ansible-playbook playbook.yml -f 10
      ```

14. **Используйте кэширование фактов**
    - Для ускорения работы с большими инфраструктурами используйте кэширование фактов (fact caching). Это позволяет хранить собранные данные о серверах для повторного использования, что снижает нагрузку на систему.
    - Включение кэширования:
      ```ini
      [defaults]
      fact_caching = jsonfile
      fact_caching_connection = /path/to/cache
      fact_caching_timeout = 86400
      ```

15. **Используйте CI/CD для автоматизации выполнения плейбуков**
    - Интегрируйте Ansible с системами CI/CD (например, Jenkins, GitLab CI) для автоматического выполнения плейбуков при изменениях в инфраструктуре или коде.
    - Настройте автоматическое тестирование плейбуков перед их развертыванием на продуктиве.

16. **Логи и отладка**
    - Включайте логирование выполнения Ansible, чтобы сохранять и анализировать результаты выполнения плейбуков.
    - Используйте опции `-v`, `-vv`, `-vvv` для увеличения детализации вывода при отладке задач.
      ```bash
      ansible-playbook playbook.yml -vvv
      ```

Эти лучшие практики помогут повысить эффективность работы с Ansible и упростить управление инфраструктурой.


Использование Ansible и Terraform вместе является мощной комбинацией для управления инфраструктурой и её конфигурацией. Оба инструмента решают разные задачи, и их совместное использование позволяет эффективно управлять как инфраструктурой, так и настройкой приложений и сервисов. Вот рекомендации по тому, как лучше разделить обязанности между Ansible и Terraform, и как их использовать совместно.

#### Ansible + Terraform

### Основные задачи Terraform:
1. **Управление инфраструктурой как кодом (IaC)**:
   - Terraform используется для создания, изменения и управления облачной инфраструктурой. Он идеально подходит для создания виртуальных машин, сетей, балансировщиков нагрузки, баз данных, хранилищ и других ресурсов в облачных провайдерах (AWS, GCP, Azure и т.д.).
   
2. **Управление инфраструктурными зависимостями**:
   - Terraform автоматически определяет зависимости между ресурсами. Например, создаёт виртуальные машины после создания сети или балансировщика нагрузки. Этот функционал делает его незаменимым для управления взаимосвязанной инфраструктурой.

3. **Поддержка мультиоблачной инфраструктуры**:
   - Terraform поддерживает множество облачных провайдеров, и его модули могут быть использованы для работы с разными типами инфраструктуры одновременно.

4. **Оркестрация ресурсов**:
   - Terraform позволяет создавать комплексные инфраструктурные сценарии, включая создание сетей, кластеров Kubernetes, запуск виртуальных машин и других ресурсов в одной цепочке операций.

### Основные задачи Ansible:
1. **Управление конфигурацией и настройка ПО**:
   - Ansible используется для управления конфигурацией серверов, развертывания приложений, настройки сервисов и управления конфигурационными файлами на существующей инфраструктуре. Ansible лучше всего подходит для задач после создания серверов и сетей.

2. **Идмопотентность конфигураций**:
   - Ansible обеспечивает идемпотентность задач, что означает, что конфигурации могут применяться многократно, не нарушая работоспособности системы.

3. **Автоматизация на уровне ОС и приложений**:
   - Ansible отлично справляется с установкой программного обеспечения, обновлением систем, настройкой сервисов (например, запуск веб-серверов, настройка базы данных, развёртывание приложений).

4. **Безагентная архитектура**:
   - Ansible не требует установки агентов на целевых серверах, что делает его удобным для работы в разных средах и упрощает управление конфигурацией.

### Когда использовать Terraform:
- **Создание облачной инфраструктуры**:
  Terraform является лучшим инструментом для создания виртуальных машин, сетей, балансировщиков нагрузки, систем хранения данных и других облачных ресурсов.
- **Управление инфраструктурой в виде кода (IaC)**:
  Terraform позволяет легко описывать инфраструктуру как код, повторно использовать её и контролировать версии инфраструктуры через системы контроля версий (например, Git).
- **Управление сложной зависимой инфраструктурой**:
  Если вам нужно создать инфраструктуру с множеством зависимостей, например, виртуальные машины, которые подключаются к виртуальным сетям и зависят от балансов нагрузки и баз данных, Terraform лучше справится с этой задачей.
- **Масштабирование инфраструктуры**:
  Terraform поддерживает автоматическое масштабирование ресурсов и изменение их конфигурации при необходимости.

### Когда использовать Ansible:
- **Настройка и управление конфигурацией серверов**:
  Ansible идеально подходит для установки и настройки программного обеспечения на серверах после их создания (например, установка веб-серверов, настройка баз данных, развёртывание приложений).
- **Автоматизация обновлений и патчей**:
  Ansible можно использовать для регулярного обновления операционных систем и программного обеспечения на серверах.
- **Развёртывание приложений**:
  Ansible удобен для автоматизации развертывания приложений, настройки сред выполнения, управления конфигурациями приложений и запуска служб.
- **Управление конфигурацией на существующей инфраструктуре**:
  После создания инфраструктуры с помощью Terraform, Ansible можно использовать для дальнейшего управления конфигурацией серверов и приложений.

### Как использовать Terraform и Ansible вместе:
1. **Создание инфраструктуры Terraform + настройка Ansible**:
   - Сначала Terraform создаёт инфраструктуру (виртуальные машины, сети, базы данных и т.д.).
   - После создания инфраструктуры Terraform может передать информацию о созданных ресурсах (например, IP-адреса серверов) Ansible для дальнейшей настройки конфигураций серверов.
   - Например, Terraform создаёт виртуальные машины в AWS, затем Ansible используется для установки и настройки веб-серверов на этих машинах.

   Пример потока:
   - **Terraform** создаёт виртуальные машины:
     ```hcl
     resource "aws_instance" "web" {
       ami           = "ami-123456"
       instance_type = "t2.micro"
       ...
     }
     ```
   - После создания инфраструктуры Terraform может генерировать инвентарь для Ansible:
     ```bash
     terraform output -json > inventory.json
     ```
   - **Ansible** использует этот инвентарь для настройки серверов:
     ```bash
     ansible-playbook -i inventory.json playbook.yml
     ```

2. **Использование динамического инвентаря в Ansible**:
   - Ansible поддерживает динамический инвентарь, который может интегрироваться с Terraform. После создания инфраструктуры Terraform, динамический инвентарь Ansible может автоматически получить список ресурсов (серверов, баз данных и т.д.) и выполнить задачи на этих ресурсах.
   - Пример: использовать плагин для динамического инвентаря AWS в Ansible для управления ресурсами, созданными Terraform.

3. **Параллельное использование в CI/CD**:
   - Terraform и Ansible могут быть интегрированы в один CI/CD pipeline. Например, сначала Terraform развертывает инфраструктуру в облаке, а затем Ansible автоматически выполняет задачи по настройке и развертыванию приложений на новых серверах.

### Что делать в Terraform, а что в Ansible:
- **Terraform**:
  - Создание облачной инфраструктуры (виртуальные машины, сети, базы данных, балансировщики нагрузки).
  - Управление инфраструктурными ресурсами (VPC, подсети, IAM-пользователи и роли).
  - Масштабирование и удаление ресурсов.
  
- **Ansible**:
  - Установка операционных систем и программного обеспечения (веб-серверы, базы данных).
  - Настройка конфигурационных файлов (nginx, apache, systemd и т.д.).
  - Развёртывание приложений и управление их версиями.
  - Выполнение обновлений и патчей на существующих серверах.
  - Мониторинг и управление сервисами (запуск, перезапуск, остановка).

### Заключение:
- **Terraform** лучше всего подходит для управления инфраструктурой как кодом (IaC), создания ресурсов в облачных средах и управления зависимостями между этими ресурсами.
- **Ansible** идеален для управления конфигурацией серверов, установки и настройки программного обеспечения и выполнения задач по управлению инфраструктурой после её создания.
- Вместе Terraform и Ansible обеспечивают полное решение для автоматизации инфраструктуры: от её создания до полной настройки и управления.

Основные и популярные задачи, которые решает Ansible, можно разделить на несколько ключевых категорий: управление конфигурацией, автоматизация развертывания, управление сервисами и сетями, а также оркестрация. Ниже приведены алгоритмы выполнения этих задач, без использования кода, только в виде общих шагов.

##### Кейсы

### 1. Установка и настройка программного обеспечения
Задача: Автоматизация установки и настройки ПО на серверах.

**Алгоритм**:
- Определить список серверов, на которых нужно установить ПО.
- Определить необходимые зависимости для установки.
- Проверить, установлено ли ПО на сервере.
- Если ПО не установлено, выполнить установку.
- После установки настроить конфигурационные файлы с использованием шаблонов или параметров.
- Проверить правильность работы ПО.
- Запустить или перезапустить службу, если требуется.

### 2. Обновление операционной системы и патчей безопасности
Задача: Автоматизация обновления операционной системы и установки патчей безопасности.

**Алгоритм**:
- Определить список серверов, которые нуждаются в обновлении.
- Собрать информацию о текущей версии операционной системы и установленных патчах.
- Проверить доступные обновления для ОС и безопасности.
- Применить доступные обновления и патчи, при необходимости выполнить перезагрузку.
- Проверить корректность работы системы после обновления.

### 3. Управление конфигурационными файлами
Задача: Автоматизация создания и управления конфигурационными файлами для приложений и систем.

**Алгоритм**:
- Определить список серверов, где необходимо изменить или создать конфигурационные файлы.
- Собрать информацию о текущей конфигурации.
- Сгенерировать новые конфигурационные файлы на основе шаблонов и переменных.
- Проверить правильность синтаксиса конфигурационного файла.
- Применить новые конфигурационные файлы, заменив старые (с резервным копированием).
- Проверить корректность работы сервиса после изменения конфигурации.
- При необходимости перезапустить соответствующие сервисы.

### 4. Развёртывание приложений
Задача: Автоматизация развертывания приложений на серверах.

**Алгоритм**:
- Определить список серверов, на которые необходимо развернуть приложение.
- Проверить доступность необходимых зависимостей и окружения для развертывания (например, базы данных, веб-серверов).
- Скопировать файлы приложения или извлечь их из хранилища (репозитория).
- Выполнить установку необходимых зависимостей (например, через package manager или Docker).
- Настроить окружение приложения (переменные среды, доступы к БД и т.д.).
- Запустить приложение и проверить его корректную работу (например, с помощью тестов или проверок доступности).

### 5. Управление сетевыми устройствами
Задача: Управление конфигурациями сетевых устройств, таких как маршрутизаторы и коммутаторы.

**Алгоритм**:
- Собрать информацию о текущем состоянии сетевого устройства (например, получить текущую конфигурацию через API или SSH).
- Сравнить текущее состояние с требуемым (например, конфигурация VLAN, маршрутов).
- Если есть расхождения, применить необходимые изменения (например, добавить или изменить маршруты, настройки сети).
- Проверить работоспособность сети после внесённых изменений.
- В случае критических ошибок восстановить предыдущую конфигурацию.

### 6. Настройка пользователей и управление правами доступа
Задача: Автоматизация добавления и управления пользователями, а также настройка прав доступа.

**Алгоритм**:
- Определить список серверов, где нужно добавить или изменить пользователей.
- Собрать информацию о текущих пользователях и их правах.
- Проверить, существует ли пользователь, которого нужно добавить или изменить.
- Если пользователь не существует, создать его с требуемыми правами и параметрами.
- Если пользователь уже существует, проверить его текущие права и изменить их при необходимости.
- Установить пароли или ключи доступа для пользователя.
- Уведомить пользователя о доступах, если это необходимо.

### 7. Управление сервисами и процессами
Задача: Автоматизация управления системными сервисами (запуск, остановка, перезагрузка).

**Алгоритм**:
- Определить список серверов, на которых необходимо управлять сервисами.
- Проверить состояние сервисов (запущен ли сервис, остановлен или не отвечает).
- В зависимости от состояния выполнить действие: запуск, перезапуск или остановка сервиса.
- Если выполняется перезапуск, сначала проверить конфигурацию сервиса.
- После выполнения действия проверить состояние сервиса и его работоспособность.

### 8. Оркестрация сложных задач
Задача: Автоматизация выполнения сложных процессов, включающих несколько шагов и зависимых действий (например, развёртывание кластера).

**Алгоритм**:
- Определить список серверов или ресурсов, с которыми необходимо работать.
- Определить порядок шагов и их зависимости друг от друга.
- Выполнить первый шаг (например, создание сетевой инфраструктуры).
- Проверить результат выполнения каждого шага и, в зависимости от него, переходить к следующему.
- Если шаг завершён неудачно, выполнить откат изменений или восстановление.
- Продолжить выполнение следующих шагов (например, развертывание контейнеров, настройка балансировки нагрузки).
- По завершению всех шагов проверить конечное состояние всей системы.

### 9. Создание резервных копий и восстановление
Задача: Автоматизация процесса создания резервных копий данных и конфигураций, а также восстановление из этих копий.

**Алгоритм**:
- Определить данные или конфигурации, которые необходимо резервировать.
- Проверить текущее состояние резервных копий (доступны ли старые копии, достаточное ли место для новых).
- Выполнить резервное копирование данных, сохранив их в указанное хранилище.
- Проверить корректность создания резервной копии.
- При необходимости восстановить данные или конфигурации из резервной копии на указанный сервер.
- Проверить работоспособность системы после восстановления.

### 10. Мониторинг состояния серверов и сервисов
Задача: Автоматизация сбора данных о состоянии серверов и сервисов для мониторинга.

**Алгоритм**:
- Определить список серверов и сервисов, которые необходимо мониторить.
- Собрать информацию о состоянии систем (использование процессора, памяти, диска, сетевой трафик).
- Отправить собранную информацию в систему мониторинга (например, Prometheus, Zabbix).
- При обнаружении отклонений от нормы уведомить администраторов или автоматически выполнить корректирующие действия.
- Продолжать периодически собирать информацию и обновлять данные в системе мониторинга.

### Заключение:
Ansible решает широкий спектр задач, связанных с автоматизацией управления инфраструктурой и конфигурацией. Его можно использовать для всего: от простой установки программ до сложной оркестрации распределённых систем и сетей. Правильное использование Ansible позволяет минимизировать ручной труд и сократить время на управление системами.





Шаблонизация в Ansible позволяет создавать динамические конфигурационные файлы и другие ресурсы с использованием шаблонов на базе Jinja2. Основные аспекты шаблонизации:

1. **Шаблоны (Templates)**:
   - Шаблоны создаются с использованием языка Jinja2, который поддерживает переменные, условия, циклы и фильтры.
   - Шаблоны могут использоваться для динамического создания конфигурационных файлов, скриптов и других ресурсов.

2. **Использование переменных**:
   - В шаблонах можно использовать переменные Ansible. Например:
     ```
     server {
       listen 80;
       server_name {{ server_name }};
       location / {
         proxy_pass http://{{ proxy_url }};
       }
     }
     ```

3. **Фильтры Jinja2**:
   - Фильтры позволяют изменять данные переменных прямо в шаблонах, например, `| default()` для указания значения по умолчанию.
     Пример:
     ```
     {{ some_var | default('default_value') }}
     ```

4. **Циклы и условия**:
   - Шаблоны Jinja2 поддерживают циклы и условия для создания более сложных файлов. Например:
     ```
     {% if environment == "production" %}
     server_name prod.example.com;
     {% else %}
     server_name dev.example.com;
     {% endif %}
     ```

5. **Передача шаблонов в задачи**:
   - Используйте модуль `template` для копирования сгенерированного шаблона на сервер:
     ```yaml
     - name: Configure Nginx
       template:
         src: nginx.conf.j2
         dest: /etc/nginx/nginx.conf
     ```

6. **Использование шаблонов для конфигурации**:
   - Шаблоны позволяют создавать индивидуальные конфигурации для каждого сервера, используя динамические данные, такие как IP-адреса, имена хостов и т.д.

