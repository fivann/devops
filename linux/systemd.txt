Identify the Target to Use to Determine if the Network Is Online

List the contents of /usr/lib/systemd/system/network*:

ls /usr/lib/systemd/system/network*
We'll see a number of targets we might be able to use. Among them, network-online.target seems like the best bet.

Run the following:

man 7 systemd.special
Search for network-online.target in the man page by typing:

/network-online
We'll see there's an entry about the network-online.target as well, and that looks like the right thing.

Press q to get back to the command prompt.

Write the Custom Service File

Change directory:

cd /etc/systemd/system

Create custom.service:

vim custom.service

Enter the following:

[Unit]
Description=Custom Service
Wants=network-online.target
After=network-online.target

[Service]
Type=forking
ExecStart=/usr/bin/emacs --daemon
ExecStop=/usr/bin/emacsclient --eval "(kill-emacs)"

[Install]
WantedBy=default.target
Save and exit the file by pressing Escape followed by :wq.

Start the service:

systemctl start custom.service
Check its status:

systemctl status custom.service
We should see it's running.


Additional Resources
Note: Please give the lab server time to finish provisioning before attempting a connection via ssh.

You've been tasked with writing a service file for a piece of software called emacs.

The command to start it is:

emacs --daemon
The command to stop it is:

emacsclient --eval "(kill-emacs)"
The emacs software will fork a process and then exit.

The software should not start until the network is online.
